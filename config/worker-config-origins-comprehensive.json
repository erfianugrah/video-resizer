{
  "version": "2.0.0",
  "lastUpdated": "2025-05-15T14:30:00Z",
  "video": {
    "derivatives": {
      "desktop": {
        "width": 1920,
        "height": 1080,
        "mode": "video",
        "audio": true,
        "duration": "5m",
        "fit": "contain",
        "loop": true,
        "description": "1920x1080 pixels. The video plays in high-definition."
      },
      "tablet": {
        "width": 1280,
        "height": 720,
        "mode": "video",
        "audio": true,
        "fit": "contain",
        "loop": true,
        "duration": "5m",
        "description": "1280x720 pixels. The video plays at medium resolution."
      },
      "mobile": {
        "width": 854,
        "height": 640,
        "mode": "video",
        "audio": true,
        "fit": "contain",
        "loop": true,
        "duration": "5m",
        "description": "854x640 pixels. The video plays at the lowest resolution and is also smaller in size."
      },
      "thumbnail": {
        "width": 320,
        "height": 240,
        "mode": "frame",
        "audio": false,
        "fit": "cover",
        "time": "00:00:05",
        "format": "jpg",
        "quality": "high",
        "description": "Static thumbnail image extracted from the video at 5 seconds."
      },
      "preview": {
        "width": 640,
        "height": 480,
        "mode": "spritesheet",
        "frames": 12,
        "interval": "30s",
        "format": "jpg",
        "fit": "contain",
        "compression": "medium",
        "description": "Sprite sheet with 12 frames at 30-second intervals for preview."
      }
    },
    "passthrough": {
      "enabled": true,
      "whitelistedFormats": [
        "mp4",
        "webm",
        "mov"
      ]
    },
    "defaults": {
      "width": null,
      "height": null,
      "mode": "video",
      "fit": null,
      "audio": true,
      "format": null,
      "time": null,
      "duration": "5m",
      "quality": null,
      "compression": null,
      "loop": null,
      "preload": null,
      "autoplay": null,
      "muted": null
    },
    "validOptions": {
      "mode": [
        "video",
        "frame",
        "spritesheet"
      ],
      "fit": [
        "contain",
        "scale-down",
        "cover"
      ],
      "format": [
        "mp4",
        "webm",
        "gif",
        "jpg",
        "webp",
        "png"
      ],
      "audio": [
        true,
        false
      ],
      "quality": [
        "low",
        "medium",
        "high",
        "auto"
      ],
      "compression": [
        "low",
        "medium",
        "high",
        "auto"
      ],
      "preload": [
        "none",
        "metadata",
        "auto"
      ],
      "loop": [
        true,
        false
      ],
      "autoplay": [
        true,
        false
      ],
      "muted": [
        true,
        false
      ]
    },
    "responsive": {
      "breakpoints": {
        "xs": 1,
        "sm": 640,
        "md": 768,
        "lg": 1024,
        "xl": 1280,
        "2xl": 1536
      },
      "availableQualities": [
        360,
        480,
        720,
        1080,
        1440,
        2160
      ],
      "deviceWidths": {
        "mobile": 640,
        "tablet": 1024,
        "desktop": 1920
      },
      "networkQuality": {
        "slow": {
          "maxWidth": 640,
          "maxHeight": 360,
          "maxBitrate": 1000000
        },
        "medium": {
          "maxWidth": 1280,
          "maxHeight": 720,
          "maxBitrate": 2500000
        },
        "fast": {
          "maxWidth": 1920,
          "maxHeight": 1080,
          "maxBitrate": 5000000
        }
      },
      "browserCapabilities": {
        "hevc": {
          "patterns": [
            "Safari/[6-9][0-9][0-9]",
            "Version\\/1[2-9]",
            "iPhone OS 1[1-9]",
            "iPad OS 1[1-9]"
          ],
          "exclusions": [
            "Chrome"
          ]
        },
        "av1": {
          "patterns": [
            "Chrome\\/[9][0-9]",
            "Edge\\/[9][0-9]",
            "Firefox\\/[9][0-9]",
            "Chrome\\/90\\."
          ]
        },
        "vp9": {
          "patterns": [
            "Chrome\\/[5-9][0-9]",
            "Edge\\/[7-9][0-9]",
            "Firefox\\/[6-9][0-9]",
            "Safari\\/60[5-9]",
            "Safari\\/[6-9][1-9][0-9]"
          ]
        },
        "webm": {
          "patterns": [
            "Chrome",
            "Firefox",
            "Edge",
            "Opera"
          ]
        }
      }
    },
    "responsiveBreakpoints": {
      "small": {
        "max": 854,
        "derivative": "mobile"
      },
      "medium": {
        "min": 855,
        "max": 1280,
        "derivative": "tablet"
      },
      "large": {
        "min": 1281,
        "derivative": "desktop"
      }
    },
    "paramMapping": {
      "width": "width",
      "height": "height",
      "fit": "fit",
      "format": "format",
      "quality": "quality",
      "time": "time",
      "duration": "duration",
      "compression": "compression",
      "audio": "audio",
      "loop": "loop",
      "preload": "preload",
      "autoplay": "autoplay",
      "muted": "muted"
    },
    "cdnCgi": {
      "basePath": "/cdn-cgi/media"
    },
    "origins": {
      "enabled": true,
      "useLegacyPathPatterns": false,
      "convertPathPatternsToOrigins": false,
      "fallbackHandling": {
        "enabled": true,
        "maxRetries": 3,
        "retryBackoffMs": 500,
        "timeoutMs": 10000
      },
      "defaultDerivative": "mobile",
      "diagnostics": {
        "includeResolverDetails": true,
        "includeTimings": true,
        "includeMatchDetails": true
      },
      "performance": {
        "cacheRegexMatchers": true,
        "parallelSourceResolution": true,
        "maxConcurrentRequests": 5
      }
    }
  },
  "cache": {
    "debug": false,
    "defaultMaxAge": 300,
    "respectOriginHeaders": true,
    "cacheEverything": false,
    "enableCacheTags": true,
    "cacheTagPrefix": "video-prod-",
    "purgeOnUpdate": false,
    "bypassQueryParameters": [
      "nocache",
      "bypass",
      "debug"
    ],
    "bypassHeaderValue": "no-cache",
    "enableKVCache": true,
    "storeIndefinitely": true,
    "enableVersioning": true,
    "ttlRefresh": {
      "minElapsedPercent": 10,
      "minRemainingSeconds": 60
    },
    "maxSizeBytes": 26214400,
    "fallback": {
      "enabled": true,
      "badRequestOnly": true,
      "preserveHeaders": [
        "Content-Type",
        "Cache-Control",
        "Etag"
      ]
    },
    "mimeTypes": {
      "video": [
        "video/mp4",
        "video/webm",
        "video/ogg",
        "video/x-msvideo",
        "video/quicktime",
        "video/x-matroska",
        "video/x-flv",
        "video/3gpp",
        "video/3gpp2",
        "video/mpeg",
        "application/x-mpegURL",
        "application/dash+xml"
      ],
      "image": [
        "image/jpeg",
        "image/jpg",
        "image/png",
        "image/webp",
        "image/gif",
        "image/avif"
      ]
    },
    "ttl": {
      "ok": 86400,
      "redirects": 300,
      "clientError": 60,
      "serverError": 10
    },
    "method": "kv"
  },
  "debug": {
    "enabled": true,
    "verbose": false,
    "includeHeaders": true,
    "includePerformance": true,
    "dashboardMode": true,
    "viewMode": true,
    "headerMode": true,
    "debugQueryParam": "debug",
    "debugViewParam": "view",
    "preserveDebugParams": false,
    "debugHeaders": [
      "X-Debug",
      "X-Debug-Enabled",
      "Debug"
    ],
    "renderStaticHtml": true,
    "includeStackTrace": false,
    "maxContentLength": 50000,
    "truncationMessage": "... [content truncated]",
    "allowedIps": [],
    "excludedPaths": [
      "/favicon.ico",
      "/robots.txt"
    ]
  },
  "logging": {
    "level": "debug",
    "format": "json",
    "includeTimestamps": true,
    "includeComponentName": true,
    "colorize": true,
    "enabledComponents": [],
    "disabledComponents": [],
    "sampleRate": 1,
    "enablePerformanceLogging": true,
    "performanceThresholdMs": 1000,
    "breadcrumbs": {
      "enabled": true,
      "maxItems": 25
    },
    "pino": {
      "level": "debug",
      "browser": {
        "asObject": true
      },
      "base": {
        "service": "video-resizer",
        "env": "production"
      }
    }
  },
  "origins": [
    {
      "name": "videos",
      "matcher": "^/videos/([a-zA-Z0-9]+)$",
      "captureGroups": ["videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "VIDEOS_BUCKET",
          "path": "videos/${videoId}.mp4"
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://videos.erfi.dev",
          "path": "videos/${videoId}"
        },
        {
          "type": "fallback",
          "priority": 3,
          "url": "https://cdn.erfi.dev",
          "path": "fallback-videos/${videoId}"
        }
      ],
      "ttl": {
        "ok": 300,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "cacheTags": ["videos", "main-catalog"],
      "metadata": {
        "description": "Main video catalog",
        "category": "content"
      }
    },
    {
      "name": "premium-videos",
      "matcher": "^/premium/([a-zA-Z0-9]+)$",
      "captureGroups": ["videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "PREMIUM_VIDEOS_BUCKET",
          "path": "premium/${videoId}.mp4",
          "auth": {
            "enabled": true,
            "type": "token",
            "tokenHeaderName": "X-Premium-Access",
            "tokenSecret": "${PREMIUM_TOKEN_SECRET}"
          }
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://premium.videos.erfi.dev",
          "path": "videos/${videoId}",
          "auth": {
            "enabled": true,
            "type": "aws-s3",
            "accessKeyVar": "PREMIUM_AWS_ACCESS_KEY",
            "secretKeyVar": "PREMIUM_AWS_SECRET_KEY",
            "region": "us-east-1",
            "service": "s3"
          }
        }
      ],
      "ttl": {
        "ok": 3600,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "accessControl": {
        "enabled": true,
        "allowedIps": ["127.0.0.1", "192.168.1.0/24"],
        "requireAuth": true,
        "authHeader": "Authorization",
        "authScheme": "Bearer"
      },
      "cacheTags": ["premium", "subscriber-content"],
      "metadata": {
        "description": "Premium subscriber content",
        "category": "premium"
      }
    },
    {
      "name": "popular",
      "matcher": "^/popular/(.*\\.mp4)",
      "captureGroups": ["videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "POPULAR_VIDEOS_BUCKET",
          "path": "popular/${videoId}"
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://videos.erfi.dev",
          "path": "popular-videos/${videoId}"
        }
      ],
      "ttl": {
        "ok": 604800,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "cacheability": true,
        "videoCompression": "low",
        "quality": "high",
        "fit": "contain"
      },
      "derivatives": {
        "mobile": {
          "width": 640,
          "height": 360,
          "compression": "high"
        },
        "tablet": {
          "width": 1024,
          "height": 576,
          "compression": "medium" 
        },
        "desktop": {
          "width": 1920,
          "height": 1080,
          "compression": "low"
        }
      },
      "responsiveSelection": {
        "enabled": true,
        "defaultDerivative": "tablet",
        "queryParam": "derivative"
      },
      "cacheTags": ["popular", "trending"],
      "metadata": {
        "description": "Popular and trending videos",
        "category": "popular"
      }
    },
    {
      "name": "shorts",
      "matcher": "^/shorts/(.*\\.mp4)",
      "captureGroups": ["videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "SHORTS_BUCKET",
          "path": "shorts/${videoId}"
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://videos.erfi.dev",
          "path": "shorts/${videoId}",
          "headers": {
            "X-Short-Format": "true",
            "X-Content-Type": "short-form"
          }
        }
      ],
      "ttl": {
        "ok": 172800,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "quality": "medium",
        "cacheability": true,
        "videoCompression": "medium"
      },
      "derivatives": {
        "mobile": {
          "width": 480,
          "height": 854,
          "compression": "medium"
        },
        "tablet": {
          "width": 720,
          "height": 1280,
          "compression": "medium"
        },
        "desktop": {
          "width": 1080,
          "height": 1920,
          "compression": "low"
        }
      },
      "dimensionRatio": "9:16",
      "cacheTags": ["shorts", "vertical-video"],
      "metadata": {
        "description": "Short-form vertical videos",
        "category": "shorts"
      }
    },
    {
      "name": "user-uploads",
      "matcher": "^/user/([^/]+)/videos/([a-zA-Z0-9\\-]+)$",
      "captureGroups": ["userId", "videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "USER_CONTENT_BUCKET",
          "path": "users/${userId}/videos/${videoId}.mp4"
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://user-content.videos.erfi.dev",
          "path": "${userId}/videos/${videoId}",
          "auth": {
            "enabled": true,
            "type": "header",
            "headers": {
              "X-User-ID": "${userId}",
              "X-Content-Access": "${USER_CONTENT_SECRET}"
            }
          }
        }
      ],
      "ttl": {
        "ok": 86400,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "cacheability": true,
        "videoCompression": "auto"
      },
      "contentModeration": {
        "enabled": true,
        "sensitiveContent": false,
        "ageRestriction": 0
      },
      "cacheTags": ["user-content", "user-${userId}"],
      "metadata": {
        "description": "User-uploaded content",
        "category": "user-content"
      }
    },
    {
      "name": "standard-formats",
      "matcher": "^/(.*\\.(mp4|webm|mov|avi|mkv|flv|wmv|m4v|3gp|ogv))",
      "captureGroups": ["videoId", "extension"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "VIDEOS_BUCKET",
          "path": "${videoId}.${extension}"
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://videos.erfi.dev",
          "path": "${videoId}.${extension}",
          "cacheControl": {
            "maxAge": 86400,
            "staleWhileRevalidate": 3600,
            "staleIfError": 86400
          }
        }
      ],
      "ttl": {
        "ok": 86400,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "cacheability": true,
        "videoCompression": "auto"
      },
      "formatMapping": {
        "mp4": {
          "contentType": "video/mp4",
          "acceptRanges": true
        },
        "webm": {
          "contentType": "video/webm",
          "acceptRanges": true
        },
        "mov": {
          "contentType": "video/quicktime",
          "acceptRanges": true
        },
        "avi": {
          "contentType": "video/x-msvideo",
          "acceptRanges": true
        }
      },
      "cacheTags": ["standard", "format-${extension}"],
      "metadata": {
        "description": "Standard video formats",
        "category": "standard"
      }
    },
    {
      "name": "livestream-vod",
      "matcher": "^/streams/recordings/([^/]+)/([a-zA-Z0-9\\-]+)$",
      "captureGroups": ["streamerId", "recordingId"],
      "sources": [
        {
          "type": "remote",
          "priority": 1,
          "url": "https://livestream-vod.erfi.dev",
          "path": "recordings/${streamerId}/${recordingId}/index.m3u8",
          "auth": {
            "enabled": true,
            "type": "query",
            "params": {
              "token": "${STREAM_ACCESS_TOKEN}",
              "sig": "${STREAM_SIGNATURE}"
            }
          }
        },
        {
          "type": "fallback",
          "priority": 2,
          "url": "https://backup-vod.erfi.dev",
          "path": "streams/${streamerId}/${recordingId}/playlist.m3u8"
        }
      ],
      "ttl": {
        "ok": 3600,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "bypassTransformation": true
      },
      "streaming": {
        "type": "hls",
        "segmentDuration": 10,
        "manifestType": "m3u8",
        "encryption": {
          "enabled": false
        }
      },
      "accessControl": {
        "enabled": true,
        "requireAuth": true,
        "authHeader": "Authorization",
        "authScheme": "Bearer"
      },
      "cacheTags": ["livestream", "vod", "streamer-${streamerId}"],
      "metadata": {
        "description": "Livestream recordings",
        "category": "streams"
      }
    },
    {
      "name": "authenticated-videos",
      "matcher": "^/authenticated-videos/(.*)",
      "captureGroups": ["videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "AUTH_VIDEOS_BUCKET",
          "path": "auth/${videoId}.mp4",
          "auth": {
            "enabled": true,
            "type": "token",
            "tokenHeaderName": "X-Auth-Token",
            "tokenSecret": "${AUTH_TOKEN_SECRET}"
          }
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://auth.videos.erfi.dev",
          "path": "authenticated/${videoId}",
          "auth": {
            "enabled": true,
            "type": "bearer",
            "accessKeyVar": "AUTH_VIDEO_ACCESS_KEY",
            "secretKeyVar": "AUTH_VIDEO_SECRET_KEY"
          }
        }
      ],
      "ttl": {
        "ok": 1800,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "quality": "high",
        "cacheability": true
      },
      "accessControl": {
        "enabled": true,
        "requireAuth": true,
        "authHeader": "Authorization",
        "authScheme": "Bearer"
      },
      "cacheTags": ["authenticated", "protected"],
      "metadata": {
        "description": "Authenticated access videos",
        "category": "protected"
      }
    },
    {
      "name": "multi-resolution",
      "matcher": "^/videos/multi-res/([a-zA-Z0-9]+)$",
      "captureGroups": ["videoId"],
      "sources": [
        {
          "type": "r2",
          "priority": 1,
          "bucketBinding": "MULTI_RES_BUCKET",
          "path": "videos/${videoId}/${derivative}.mp4",
          "resolutionPathTemplate": true
        },
        {
          "type": "remote",
          "priority": 2,
          "url": "https://multi-res.videos.erfi.dev",
          "path": "${videoId}/${derivative}",
          "resolutionPathTemplate": true
        }
      ],
      "ttl": {
        "ok": 86400,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "multiResolution": {
        "enabled": true,
        "resolutions": {
          "360p": {
            "width": 640,
            "height": 360,
            "bitrate": 800000
          },
          "480p": {
            "width": 854,
            "height": 480,
            "bitrate": 1400000
          },
          "720p": {
            "width": 1280,
            "height": 720,
            "bitrate": 2800000
          },
          "1080p": {
            "width": 1920,
            "height": 1080,
            "bitrate": 5000000
          }
        },
        "defaultResolution": "720p",
        "queryParam": "resolution"
      },
      "cacheTags": ["multi-res", "adaptive"],
      "metadata": {
        "description": "Multi-resolution videos",
        "category": "adaptive"
      }
    },
    {
      "name": "default",
      "matcher": ".*",
      "sources": [
        {
          "type": "remote",
          "priority": 1,
          "url": "https://videos.erfi.dev",
          "path": "${request_path}"
        }
      ],
      "ttl": {
        "ok": 300,
        "redirects": 300,
        "clientError": 60,
        "serverError": 10
      },
      "transformOptions": {
        "processPath": false
      },
      "cacheTags": ["default"],
      "metadata": {
        "description": "Default fallback pattern",
        "category": "default"
      }
    }
  ]
}